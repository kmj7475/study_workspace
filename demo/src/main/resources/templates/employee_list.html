<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8"/>
    <title>직원 목록</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"/>
</head>
<body>
<div class="container mt-4">
    <h2>직원 목록</h2>

    <!-- 검색 폼: controller가 @ModelAttribute("employee") 또는 "employee" 를 기대한다고 가정 -->
    <form th:action="@{/employees}" th:object="${employee}" method="get" class="row g-2 align-items-end mb-3">
        <div class="col-auto">
            <label for="empNo" class="form-label">사원번호</label>
            <input type="number" id="empNo" class="form-control" th:field="*{empNo}" placeholder="사원번호"/>
        </div>
        <div class="col-auto">
            <label for="empName" class="form-label">이름</label>
            <input type="text" id="empName" class="form-control" th:field="*{empName}" placeholder="이름"/>
        </div>
        <div class="col-auto">
            <button type="submit" class="btn btn-primary">검색</button>
            <a th:href="@{/employees}" class="btn btn-outline-secondary ms-2">초기화</a>
            <a th:href="@{/employees/new}" class="btn btn-success ms-2">신규 등록</a>
        </div>
    </form>

    <!-- 직원 테이블 -->
    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
            <thead class="table-dark">
                <tr>
                    <th>사원번호</th>
                    <th>이름</th>
                    <th>이메일</th>
                    <th>전화번호</th>
                    <th>입사일</th>
                    <th class="text-end">급여</th>
                    <th>담당 도서</th>
                    <th>액션</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="emp : ${employees}">
                    <td th:text="${emp.empNo}">100</td>
                    <td th:text="${emp.empName}">홍길동</td>

                    <!-- 이메일 -->
                    <td th:text="${emp.email != null ? emp.email : '-'}">example@domain.com</td>

                    <!-- 전화번호 -->
                    <td th:text="${emp.phoneNumber != null ? emp.phoneNumber : '-'}">010-1234-5678</td>

                    <!-- 입사일 포맷 -->
                    <td th:text="${emp.hireDate != null ? #dates.format(emp.hireDate,'yyyy-MM-dd') : '-'}">2025-01-01</td>

                    <!-- 급여 포맷(숫자) -->
                    <td class="text-end" th:text="${emp.salary != null ? emp.salary : '-'}">30000000</td>

                    <!-- 담당 도서: emp.books 컬렉션을 가정 -->
                    <td>
                        <div th:if="${emp.books == null or #lists.isEmpty(emp.books)}">-</div>
                        <div th:if="${emp.books != null and !#lists.isEmpty(emp.books)}">
                            <ul class="list-unstyled mb-0">
                                <li th:each="book, idx : ${emp.books}">
                                    <a th:if="${book.bookNo != null}"
                                       th:href="@{/books/{id}(id=${book.bookNo})}"
                                       th:text="${book.bookName}">도서명</a>
                                    <span th:if="${book.bookNo == null}" th:text="${book.bookName}">도서명</span>
                                    <small class="text-muted" th:if="${book.isbn != null}"> (ISBN: <span th:text="${book.isbn}">isbn</span>)</small>
                                    <span th:if="${!idx.last}">, </span>
                                </li>
                            </ul>
                        </div>
                    </td>

                    <td>
                        <a th:href="@{/employees/{id}(id=${emp.empNo})}" class="btn btn-sm btn-info">조회</a>
                        <a th:href="@{/employees/edit/{id}(id=${emp.empNo})}" class="btn btn-sm btn-warning ms-1">수정</a>
                        <a th:href="@{/employees/delete/{id}(id=${emp.empNo})}"
                           th:onclick="|return confirm('사원번호 ${emp.empNo} 를 삭제하시겠습니까?');|"
                           class="btn btn-sm btn-danger ms-1">삭제</a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- 필요시 페이징/통계 영역 추가 가능 -->
</div>
</body>
</html>